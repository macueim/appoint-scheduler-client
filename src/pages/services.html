<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Provider - AppointScheduler</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="flex flex-col min-h-screen bg-gray-100 font-sans antialiased" x-data="servicesApp()" x-init="init()">

<!-- Header (Same as index.html) -->
 <header class="bg-white shadow-lg py-4">
        <div class="container mx-auto px-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <img src="../../public/images/logo.png" alt="AppointScheduler Logo" class="mr-2 rounded-full shadow-sm" style="height:50px; width:50px;">

                <span class="text-2xl font-extrabold text-gray-900">AppointScheduler</span>
            </div>
            <div class="w-full md:w-1/3 mb-4 md:mb-0 relative">
                <form id="searchForm" action="search-results.html" method="get" onsubmit="return validateSearch()">
                    <input type="text" id="searchInput" name="query" placeholder="Search for services or providers..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <button type="submit" class="hidden">Search</button>
                </form>
                <script>
                    function validateSearch() {
                        const searchInput = document.getElementById('searchInput');
                        const query = searchInput.value.trim();

                        if (query === '') {
                            return false; // Prevent form submission if search is empty
                        }
                        return true; // Allow form submission
                    }
                </script>
            </div>
            <nav class="hidden md:flex space-x-2">
                <a href="../../index.html" class="text-gray-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-50 hover:text-blue-700 hover:shadow-md transform hover:scale-105 transition duration-300 ease-in-out">Home</a>
                <a href="about-us.html" class="text-gray-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-50 hover:text-blue-700 hover:shadow-md transform hover:scale-105 transition duration-300 ease-in-out">About Us</a>
                <a href="services.html" class="text-gray-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-50 hover:text-blue-700 hover:shadow-md transform hover:scale-105 transition duration-300 ease-in-out">Services</a>
                <a href="cart.html" class="text-gray-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-50 hover:text-blue-700 hover:shadow-md transform hover:scale-105 transition duration-300 ease-in-out">Your Cart</a>
                <a href="login.html" class="text-blue-600 font-semibold py-2 px-4 rounded-lg hover:bg-blue-50 hover:text-blue-700 hover:shadow-md transform hover:scale-105 transition duration-300 ease-in-out">Login/Sign Up</a>
            </nav>

            <div class="md:hidden" x-data="{ open: false }">
                <button @click="open = !open" class="text-gray-600 hover:text-blue-600 focus:outline-none">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>

                <div x-show="open" @click.away="open = false" class="absolute top-44 right-4 bg-white shadow-lg rounded-md p-4 space-y-2 z-10 w-48 border border-gray-200">
                    <a href="../../index.html" class="block text-gray-700 font-medium py-2 px-3 rounded-md hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm transition duration-300">Home</a>
                    <a href="about-us.html" class="block text-gray-700 font-medium py-2 px-3 rounded-md hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm transition duration-300">About Us</a>
                    <a href="services.html" class="block text-gray-700 font-medium py-2 px-3 rounded-md hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm transition duration-300">Services</a>
                    <a href="cart.html" class="block text-gray-700 font-medium py-2 px-3 rounded-md hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm transition duration-300">Your Cart.</a>
                    <a href="login.html" class="block text-blue-600 font-semibold py-2 px-3 rounded-md hover:bg-blue-50 hover:text-blue-700 hover:shadow-sm transition duration-300">Login/Sign Up</a>
                </div>
            </div>
        </div>
    </header>

<!-- Loading Indicator -->
<div x-show="loading" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-5 rounded-lg shadow-xl flex items-center space-x-4">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <p class="text-gray-700 font-medium">Loading data...</p>
    </div>
</div>

<!-- Main Content -->
<main class="flex-grow container mx-auto px-4 py-8">
    <!-- Business Header -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Business Provider</h1>
                <h2 class="text-2xl font-semibold text-blue-600 mt-2" x-text="businessName || 'Loading...'"></h2>
                <p class="text-gray-600 mt-2" x-text="businessAddress || 'Loading address...'"></p>
            </div>
            <div class="mt-4 md:mt-0">
                <button @click="openAddModal()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transform hover:scale-105 transition duration-300 ease-in-out">
                    <i class="fas fa-plus mr-2"></i> Add New Service
                </button>
            </div>
        </div>
    </div>

    <!-- Filter and Search -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <div class="flex flex-col md:flex-row gap-4 items-end">
            <div class="w-full md:w-1/3">
                <label for="serviceSearch" class="block text-sm font-medium text-gray-700 mb-1">Search Services</label>
                <div class="relative">
                    <input
                            type="text"
                            id="serviceSearch"
                            x-model="searchTerm"
                            @input="filterServices()"
                            placeholder="Search by name or description..."
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300"
                    >
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                </div>
            </div>
            <div class="w-full md:w-1/4">
                <label for="categoryFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Category</label>
                <select
                        id="categoryFilter"
                        x-model="selectedCategory"
                        @change="filterServices()"
                        class="w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300"
                >
                    <option value="">All Categories</option>
                    <template x-for="category in categories" :key="category.id">
                        <option :value="category.id" x-text="category.name"></option>
                    </template>
                </select>
            </div>
            <div class="w-full md:w-1/4">
                <label for="priceFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Price Range</label>
                <select
                        id="priceFilter"
                        x-model="priceFilter"
                        @change="filterServices()"
                        class="w-full py-2 px-3 border border-gray-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300"
                >
                    <option value="">All Prices</option>
                    <option value="0-50">$0 - $50</option>
                    <option value="50-100">$50 - $100</option>
                    <option value="100-150">$100 - $150</option>
                    <option value="150+">$150+</option>
                </select>
            </div>
            <div>
                <button
                        @click="resetFilters()"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out"
                >
                    <i class="fas fa-redo-alt mr-2"></i> Reset
                </button>
            </div>
        </div>
    </div>

    <!-- Services Table -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Name
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Category
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Duration
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Price
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Status
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Actions
                    </th>
                </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                <template x-if="loading">
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            <div class="animate-pulse flex flex-col items-center py-4">
                                <div class="h-4 bg-gray-200 rounded w-1/2 mb-2.5"></div>
                                <div class="h-4 bg-gray-200 rounded w-1/3"></div>
                            </div>
                        </td>
                    </tr>
                </template>
                <template x-if="!loading && filteredServices.length === 0">
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            <div class="flex flex-col items-center justify-center py-8">
                                <svg class="h-12 w-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <p class="text-gray-700 font-medium">No services found matching your criteria.</p>
                                <button @click="resetFilters()" class="mt-3 text-blue-600 hover:text-blue-800 font-medium">
                                    Reset filters
                                </button>
                            </div>
                        </td>
                    </tr>
                </template>
                <template x-for="(service, index) in paginatedServices" :key="service.id">
                    <tr class="hover:bg-gray-50 transition duration-200">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div>
                                    <div class="text-sm font-medium text-gray-900" x-text="service.name"></div>
                                    <div class="text-sm text-gray-500" x-text="truncateText(service.description, 50)"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900" x-text="getCategoryName(service.category_id)"></div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900" x-text="`${service.duration} min (${service.buffer_time} min buffer)`"></div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900" x-text="`$${service.price.toFixed(2)}`"></div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                          :class="service.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                        <span x-text="service.is_active ? 'Active' : 'Inactive'"></span>
                                    </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-3">
                                <button @click="viewService(service)" class="text-blue-600 hover:text-blue-900 transition duration-200">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button @click="editService(service)" class="text-indigo-600 hover:text-indigo-900 transition duration-200">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="confirmDelete(service)" class="text-red-600 hover:text-red-900 transition duration-200">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </template>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        Showing
                        <span class="font-medium" x-text="filteredServices.length === 0 ? 0 : (currentPage - 1) * pageSize + 1"></span>
                        to
                        <span class="font-medium" x-text="Math.min(currentPage * pageSize, filteredServices.length)"></span>
                        of
                        <span class="font-medium" x-text="filteredServices.length"></span>
                        results
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        <button @click="currentPage = Math.max(1, currentPage - 1)" :disabled="currentPage === 1" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" :class="{ 'opacity-50 cursor-not-allowed': currentPage === 1 }">
                            <span class="sr-only">Previous</span>
                            <i class="fas fa-chevron-left text-xs"></i>
                        </button>
                        <template x-for="page in pageCount" :key="page">
                            <button @click="currentPage = page" :class="{ 'bg-blue-50 border-blue-500 text-blue-600': page === currentPage, 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50': page !== currentPage }" class="relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                                <span x-text="page"></span>
                            </button>
                        </template>
                        <button @click="currentPage = Math.min(pageCount, currentPage + 1)" :disabled="currentPage === pageCount || pageCount === 0" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50" :class="{ 'opacity-50 cursor-not-allowed': currentPage === pageCount || pageCount === 0 }">
                            <span class="sr-only">Next</span>
                            <i class="fas fa-chevron-right text-xs"></i>
                        </button>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- View Service Modal -->
<div x-show="showViewModal" class="fixed inset-0 z-50 overflow-y-auto" style="display: none;">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4" x-text="currentService.name"></h3>
                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                    <div class="mb-3">
                        <span class="font-semibold text-gray-700">Category:</span>
                        <span class="ml-2" x-text="getCategoryName(currentService.category_id)"></span>
                    </div>
                    <div class="mb-3">
                        <span class="font-semibold text-gray-700">Description:</span>
                        <p class="mt-1 text-gray-600" x-text="currentService.description"></p>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-2">
                        <div>
                            <span class="font-semibold text-gray-700">Duration:</span>
                            <span class="ml-2" x-text="`${currentService.duration} minutes`"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Buffer Time:</span>
                            <span class="ml-2" x-text="`${currentService.buffer_time} minutes`"></span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-2">
                        <div>
                            <span class="font-semibold text-gray-700">Price:</span>
                            <span class="ml-2" x-text="`$${currentService.price.toFixed(2)}`"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Max Clients:</span>
                            <span class="ml-2" x-text="currentService.max_clients"></span>
                        </div>
                    </div>
                    <div>
                        <span class="font-semibold text-gray-700">Status:</span>
                        <span class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                              :class="currentService.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                <span x-text="currentService.is_active ? 'Active' : 'Inactive'"></span>
                            </span>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" @click="showViewModal = false" class="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Service Modal -->
<div x-show="showAddModal || showEditModal" class="fixed inset-0 z-50 overflow-y-auto" style="display: none;">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <form @submit.prevent="saveService()">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4" x-text="showAddModal ? 'Add New Service' : 'Edit Service'"></h3>
                    <div class="space-y-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Service Name</label>
                            <input type="text" id="name" x-model="currentService.name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
                            <select id="category" x-model="currentService.category_id" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select a category</option>
                                <template x-for="category in categories" :key="category.id">
                                    <option :value="category.id" x-text="category.name"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="description" x-model="currentService.description" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="duration" class="block text-sm font-medium text-gray-700">Duration (minutes)</label>
                                <input type="number" id="duration" x-model.number="currentService.duration" min="1" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="buffer_time" class="block text-sm font-medium text-gray-700">Buffer Time (minutes)</label>
                                <input type="number" id="buffer_time" x-model.number="currentService.buffer_time" min="0" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="price" class="block text-sm font-medium text-gray-700">Price ($)</label>
                                <input type="number" id="price" x-model.number="currentService.price" min="0" step="0.01" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="max_clients" class="block text-sm font-medium text-gray-700">Max Clients</label>
                                <input type="number" id="max_clients" x-model.number="currentService.max_clients" min="1" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="is_active" x-model="currentService.is_active" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="is_active" class="ml-2 block text-sm text-gray-900">
                                Active
                            </label>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Save
                    </button>
                    <button type="button" @click="cancelEdit()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div x-show="showDeleteModal" class="fixed inset-0 z-50 overflow-y-auto" style="display: none;">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 transition-opacity" aria-hidden="true">
            <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
        </div>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Delete Service
                        </h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500">
                                Are you sure you want to delete the service "<span x-text="currentService.name"></span>"? This action cannot be undone.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" @click="deleteService()" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm">
                    Delete
                </button>
                <button type="button" @click="showDeleteModal = false" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                    Cancel
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notification -->
<div
        x-show="toast.show"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 transform scale-90"
        x-transition:enter-end="opacity-100 transform scale-100"
        x-transition:leave="transition ease-in duration-300"
        x-transition:leave-start="opacity-100 transform scale-100"
        x-transition:leave-end="opacity-0 transform scale-90"
        @click="toast.show = false"
        class="fixed bottom-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg max-w-md"
        :class="{
            'bg-green-500 text-white': toast.type === 'success',
            'bg-red-500 text-white': toast.type === 'error',
            'bg-blue-500 text-white': toast.type === 'info'
        }"
        style="display: none;"
>
    <div class="flex items-center">
        <div class="flex-shrink-0 mr-3">
            <template x-if="toast.type === 'success'">
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
            </template>
            <template x-if="toast.type === 'error'">
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
            </template>
            <template x-if="toast.type === 'info'">
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
            </template>
        </div>
        <div>
            <p class="font-medium" x-text="toast.message"></p>
        </div>
    </div>
</div>

<!-- Footer - copied from index.html -->
<footer class="bg-gray-900 text-white py-8">
    <div class="container mx-auto px-4 text-center">
        <p class="mb-4 text-gray-300">&copy; 2025 AppointScheduler. All rights reserved.</p>
        <div class="flex justify-center space-x-7 mb-6">
            <a href="https://facebook.com/AppointScheduler" target="_blank" class="text-gray-400 hover:text-blue-500 transition duration-300 transform hover:scale-110">
                <i class="fab fa-facebook-f fa-2x"></i>
            </a>
            <a href="https://x.com/AppointScheduler" target="_blank" class="text-gray-400 hover:text-blue-400 transition duration-300 transform hover:scale-110">
                <i class="fab fa-twitter fa-2x"></i>
            </a>
            <a href="https://linkedin.com/company/AppointScheduler" target="_blank" class="text-gray-400 hover:text-blue-600 transition duration-300 transform hover:scale-110">
                <i class="fab fa-linkedin-in fa-2x"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-red-600 transition duration-300 transform hover:scale-110">
                <i class="fab fa-youtube fa-2x"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-pink-500 transition duration-300 transform hover:scale-110">
                <i class="fab fa-instagram fa-2x"></i>
            </a>
        </div>
        <p class="text-sm">
            <a href="#" class="text-gray-400 hover:text-white mx-3 transition duration-300">Privacy Policy</a> |
            <a href="#" class="text-gray-400 hover:text-white mx-3 transition duration-300">Terms of Service</a> |
            <a href="#" class="text-gray-400 hover:text-white mx-3 transition duration-300">Contact Us</a> |
            <a href="#" class="text-gray-400 hover:text-white mx-3 transition duration-300">FAQ</a>
        </p>
    </div>
</footer>

<script>
    function servicesApp() {
        return {
            services: [],
            filteredServices: [],
            categories: [],
            businesses: [],
            businessName: '',
            businessAddress: '',
            searchTerm: '',
            selectedCategory: '',
            priceFilter: '',
            currentPage: 1,
            pageSize: 5,
            loading: true,
            currentService: {
                id: null,
                business_id: 1,
                category_id: '',
                name: '',
                description: '',
                duration: 30,
                buffer_time: 15,
                max_clients: 1,
                price: 0,
                is_active: true
            },
            showViewModal: false,
            showAddModal: false,
            showEditModal: false,
            showDeleteModal: false,
            toast: {
                show: false,
                message: '',
                type: 'info',
                timeout: null
            },

            init() {
                this.fetchData();
            },

            async fetchData() {
                this.loading = true;

                try {
                    // Fetch all data in parallel
                    const [servicesResponse, categoriesResponse, businessesResponse] = await Promise.all([
                        fetch('https://appointment-scheduler-backend-smss.onrender.com/services'),
                        fetch('https://appointment-scheduler-backend-smss.onrender.com/service-categories'),
                        fetch('https://appointment-scheduler-backend-smss.onrender.com/businesses')
                    ]);

                    // Process responses
                    if (!servicesResponse.ok) throw new Error('Failed to fetch services');
                    if (!categoriesResponse.ok) throw new Error('Failed to fetch categories');
                    if (!businessesResponse.ok) throw new Error('Failed to fetch businesses');

                    // Parse JSON data
                    const servicesData = await servicesResponse.json();
                    const categoriesData = await categoriesResponse.json();
                    const businessesData = await businessesResponse.json();

                    // Update state with fetched data
                    this.services = servicesData;
                    this.categories = categoriesData;
                    this.businesses = businessesData;

                    // Set business info (using first business for this example)
                    if (businessesData && businessesData.length > 0) {
                        this.businessName = businessesData[0].name;
                        this.businessAddress = businessesData[0].address;
                        this.currentService.business_id = businessesData[0].id;
                    }

                    // Apply initial filtering
                    this.filterServices();

                    // Show success message
                    this.showToast('Services loaded successfully', 'success');
                } catch (error) {
                    console.error('Error fetching data:', error);
                    this.showToast('Failed to load data: ' + error.message, 'error');
                } finally {
                    this.loading = false;
                }
            },

            filterServices() {
                let filtered = [...this.services];

                // Filter by search term
                if (this.searchTerm.trim() !== '') {
                    const term = this.searchTerm.toLowerCase();
                    filtered = filtered.filter(service =>
                        service.name.toLowerCase().includes(term) ||
                        service.description.toLowerCase().includes(term)
                    );
                }

                // Filter by category
                if (this.selectedCategory) {
                    filtered = filtered.filter(service =>
                        service.category_id === parseInt(this.selectedCategory)
                    );
                }

                // Filter by price range
                if (this.priceFilter) {
                    if (this.priceFilter === '0-50') {
                        filtered = filtered.filter(service => service.price >= 0 && service.price <= 50);
                    } else if (this.priceFilter === '50-100') {
                        filtered = filtered.filter(service => service.price > 50 && service.price <= 100);
                    } else if (this.priceFilter === '100-150') {
                        filtered = filtered.filter(service => service.price > 100 && service.price <= 150);
                    } else if (this.priceFilter === '150+') {
                        filtered = filtered.filter(service => service.price > 150);
                    }
                }

                this.filteredServices = filtered;
                this.currentPage = 1; // Reset to first page when filtering
            },

            resetFilters() {
                this.searchTerm = '';
                this.selectedCategory = '';
                this.priceFilter = '';
                this.filterServices();
            },

            get pageCount() {
                return Math.max(1, Math.ceil(this.filteredServices.length / this.pageSize));
            },

            get paginatedServices() {
                const start = (this.currentPage - 1) * this.pageSize;
                const end = start + this.pageSize;
                return this.filteredServices.slice(start, end);
            },

            getCategoryName(categoryId) {
                const category = this.categories.find(cat => cat.id === categoryId);
                return category ? category.name : 'Unknown';
            },

            truncateText(text, maxLength) {
                if (!text) return '';
                return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
            },

            viewService(service) {
                this.currentService = JSON.parse(JSON.stringify(service)); // Deep copy
                this.showViewModal = true;
            },

            openAddModal() {
                this.resetCurrentService();
                this.showAddModal = true;
            },

            editService(service) {
                this.currentService = JSON.parse(JSON.stringify(service)); // Deep copy
                this.showEditModal = true;
            },

            confirmDelete(service) {
                this.currentService = JSON.parse(JSON.stringify(service)); // Deep copy
                this.showDeleteModal = true;
            },

            async deleteService() {
                try {
                    // In a real application, this would send a DELETE request to the API
                    // For simulation purposes, we'll just remove it from the local array
                    this.loading = true;

                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 500));

                    // Remove from local data
                    this.services = this.services.filter(s => s.id !== this.currentService.id);
                    this.filterServices();

                    this.showToast('Service deleted successfully', 'success');
                } catch (error) {
                    console.error('Error deleting service:', error);
                    this.showToast('Failed to delete service: ' + error.message, 'error');
                } finally {
                    this.showDeleteModal = false;
                    this.loading = false;
                }
            },

            async saveService() {
                try {
                    this.loading = true;

                    // Simulate API call delay
                    await new Promise(resolve => setTimeout(resolve, 500));

                    if (this.showAddModal) {
                        // Simulate creating a new service with a unique ID
                        const newId = Math.max(...this.services.map(s => s.id), 0) + 1;
                        const newService = {
                            ...this.currentService,
                            id: newId,
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        };
                        this.services.push(newService);
                        this.showToast('Service added successfully', 'success');
                    } else {
                        // Update existing service
                        const index = this.services.findIndex(s => s.id === this.currentService.id);
                        if (index !== -1) {
                            this.services[index] = {
                                ...this.currentService,
                                updated_at: new Date().toISOString()
                            };
                            this.showToast('Service updated successfully', 'success');
                        }
                    }

                    this.filterServices();
                } catch (error) {
                    console.error('Error saving service:', error);
                    this.showToast('Failed to save service: ' + error.message, 'error');
                } finally {
                    this.showAddModal = false;
                    this.showEditModal = false;
                    this.loading = false;
                }
            },

            cancelEdit() {
                this.showAddModal = false;
                this.showEditModal = false;
                this.resetCurrentService();
            },

            resetCurrentService() {
                const businessId = this.businesses.length > 0 ? this.businesses[0].id : 1;

                this.currentService = {
                    id: null,
                    business_id: businessId,
                    category_id: '',
                    name: '',
                    description: '',
                    duration: 30,
                    buffer_time: 15,
                    max_clients: 1,
                    price: 0,
                    is_active: true
                };
            },

            showToast(message, type = 'info') {
                if (this.toast.timeout) {
                    clearTimeout(this.toast.timeout);
                }

                this.toast.message = message;
                this.toast.type = type;
                this.toast.show = true;

                this.toast.timeout = setTimeout(() => {
                    this.toast.show = false;
                }, 3000);
            }
        };
    }
</script>
</body>
</html>